paths:
  /api/reports:
    get:
      summary: List shipment reports (route history summaries) for the authenticated user
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Zero-based page index (default 0).
        - in: query
          name: size
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Page size (default 20, max 100).
        - in: query
          name: archived
          schema:
            type: boolean
          description: Include archived entries (default false).
      responses:
        '200':
          description: Route report summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RouteReportSummaryListResponse'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/users/{userId}/route-history:
    get:
      summary: List route history for a user
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/RouteHistoryStatus'
        - in: query
          name: source
          schema:
            $ref: '#/components/schemas/RouteHistorySource'
        - in: query
          name: archived
          schema:
            type: boolean
        - in: query
          name: routeId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            minimum: 0
          description: Zero-based page number.
        - in: query
          name: size
          schema:
            type: integer
            minimum: 1
            maximum: 200
          description: Page size (default 20).
      responses:
        '200':
          description: Route history page
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RouteHistoryListResponse'
        '403':
          $ref: '#/components/responses/ForbiddenError'
  /api/route-history/{historyId}:
    get:
      summary: Retrieve a single route history item
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: historyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Route history item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RouteHistoryItemResource'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/route-history/{historyId}/archive:
    patch:
      summary: Archive a route history item
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: historyId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
      responses:
        '200':
          description: Archived item
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RouteHistoryItemResource'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/reports/{historyId}/pdf:
    get:
      summary: Download route report as PDF
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: historyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF report
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
  /api/reports/{historyId}/excel:
    get:
      summary: Download route report as Excel
      tags:
        - Route History
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: historyId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Excel report
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
        '404':
          $ref: '#/components/responses/NotFoundError'
components:
  schemas:
    RouteReportSummaryResource:
      type: object
      properties:
        historyId:
          type: string
        shipmentId:
          type: string
        routeLabel:
          type: string
        origin:
          type: string
          nullable: true
        destination:
          type: string
          nullable: true
        status:
          $ref: '#/components/schemas/RouteHistoryStatus'
        progress:
          type: number
          format: double
        departureTime:
          type: string
          format: date-time
          nullable: true
        estimatedArrivalTime:
          type: string
          format: date-time
          nullable: true
        totalDistance:
          type: number
          format: double
          nullable: true
        costEstimate:
          type: number
          format: double
          nullable: true
      required:
        - historyId
        - shipmentId
        - routeLabel
        - status
        - progress
    RouteReportSummaryListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/RouteReportSummaryResource'
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
      required:
        - items
        - page
        - size
        - totalElements
        - totalPages
    RouteHistoryItemResource:
      type: object
      properties:
        id:
          type: string
        tenantId:
          type: string
          nullable: true
        userId:
          type: string
        routeId:
          type: string
          nullable: true
        originPortId:
          type: string
          nullable: true
        originPortName:
          type: string
          nullable: true
        destinationPortId:
          type: string
          nullable: true
        destinationPortName:
          type: string
          nullable: true
        waypointPortIds:
          type: array
          items:
            type: string
        avoidedPortIds:
          type: array
          items:
            type: string
        computedAt:
          type: string
          format: date-time
        engineVersion:
          type: string
          nullable: true
        totalDistance:
          type: number
          format: double
          nullable: true
        durationEstimate:
          type: number
          format: double
          nullable: true
        costEstimate:
          type: number
          format: double
          nullable: true
        status:
          $ref: '#/components/schemas/RouteHistoryStatus'
        source:
          $ref: '#/components/schemas/RouteHistorySource'
        notes:
          type: string
          nullable: true
        archived:
          type: boolean
        metadata:
          type: object
          additionalProperties: true
        pathEncoding:
          type: string
          nullable: true
        geojson:
          type: object
          nullable: true
      required:
        - id
        - userId
        - originPortId
        - destinationPortId
        - waypointPortIds
        - avoidedPortIds
        - computedAt
        - status
        - source
        - archived
        - metadata
    RouteHistoryListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/RouteHistoryItemResource'
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        nextCursor:
          type: string
          nullable: true
      required:
        - items
        - page
        - size
        - totalElements
        - totalPages
    RouteHistoryStatus:
      type: string
      enum:
        - SUCCESS
        - NO_VIABLE_ROUTE
        - CANCELLED
    RouteHistorySource:
      type: string
      enum:
        - AUTO
        - MANUAL
        - OPERATOR_OVERRIDE
  responses:
    ForbiddenError:
      description: The caller is not authorized to access the requested resource.
    NotFoundError:
      description: Route history entry not found.
